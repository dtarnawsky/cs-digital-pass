# Digital Passes



## Adding to Apple Wallet

Digital passes for Apple Wallet are a file format called `pkpass`. 

You can create these, send them as email attachments, or download them as files. They are generated by your backend server (see [Creating Apple Passes](#creating-apple-passes)).


## Downloading a pkpass file
You can download a pkpass file using the standard JS fetch api:
```typescript
  public async get(url: string): Promise<string> {
    const response = await fetch(url);
    const blob = await response.blob();
    const base64 = await blobToBase64(blob);
    if (!base64 || base64 instanceof ArrayBuffer) {
      throw new Error(`Unable to get ${url}`);
    }
    return base64;
  }
```

As we need the pkpass data base64 encoded we have a helper function called `blobToBase64`:
```typescript
function blobToBase64(blob: Blob): Promise<string | ArrayBuffer | null> {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onerror = reject;
    reader.onload = () => {
      resolve(reader.result);
    };
    reader.readAsDataURL(blob);
  });
}
```

## Adding to Apple Wallet

You can add your pkpass data to the mobile device using a plugin called `capacitor-pass-to-wallet` which you can install with:

```bash
npm install capacitor-pass-to-wallet
npx cap sync
```

Call the `addToWallet` function passing in the base64 pkpass data you downloaded:

```typescript
import { CapacitorPassToWallet } from 'capacitor-pass-to-wallet';
...
await CapacitorPassToWallet.addToWallet({ base64: data });
```

You should see a standard Apple "add pass" dialog with details of your pass. The user can click "Add" to add to Apple Wallet.

## Creating Apple Passes

Apple provides a good introduction to [creating your first pass](https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/YourFirst.html#//apple_ref/doc/uid/TP40012195-CH2-SW1), [designing passes](https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/Creating.html#//apple_ref/doc/uid/TP40012195-CH4-SW1) and [distributing passes](https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/DistributingPasses.html#//apple_ref/doc/uid/TP40012195-CH11-SW1).

While you can manually create passes it is best to have a backend server create the pass and provide it to the app. This is because passes are digitally signed using a Pass Type ID and Production Certificate created in your Apple Developer Account.

You can create an Apple pass with a nodejs backend by following this [video tutorial](https://www.youtube.com/watch?v=rJZdPoXHtzI).

## Changing Passes
A pass can change over time. For example: an airline pass can be changed if a plane is delayed, a ID Card can change after it has expired or a ticket can change when it has been transferred to another person.

Apple provides a way through push notifications to handle updates with passes. See [Working with Passes](https://developer.apple.com/library/archive/documentation/UserExperience/Conceptual/PassKit_PG/Updating.html#//apple_ref/doc/uid/TP40012195-CH5-SW1).

